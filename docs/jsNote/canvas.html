<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>学习笔记 | 好玩的canvas</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/sweetLearnNote/assets/css/18.styles.2c39990c.css" as="style"><link rel="preload" href="/sweetLearnNote/assets/js/app.e5601e0e.js" as="script"><link rel="preload" href="/sweetLearnNote/assets/js/15.1410e0a9.js" as="script"><link rel="prefetch" href="/sweetLearnNote/assets/js/9.70ab4479.js"><link rel="prefetch" href="/sweetLearnNote/assets/js/0.8cb660a1.js"><link rel="prefetch" href="/sweetLearnNote/assets/js/1.b71d7909.js"><link rel="prefetch" href="/sweetLearnNote/assets/js/2.60c45cf5.js"><link rel="prefetch" href="/sweetLearnNote/assets/js/3.9252117b.js"><link rel="prefetch" href="/sweetLearnNote/assets/js/4.b6648632.js"><link rel="prefetch" href="/sweetLearnNote/assets/js/5.d89a6dc2.js"><link rel="prefetch" href="/sweetLearnNote/assets/js/6.94abd5d3.js"><link rel="prefetch" href="/sweetLearnNote/assets/js/7.b672e33a.js"><link rel="prefetch" href="/sweetLearnNote/assets/js/8.d21e556a.js"><link rel="prefetch" href="/sweetLearnNote/assets/js/10.387e71e0.js"><link rel="prefetch" href="/sweetLearnNote/assets/js/11.4a180f15.js"><link rel="prefetch" href="/sweetLearnNote/assets/js/12.49e089b6.js"><link rel="prefetch" href="/sweetLearnNote/assets/js/13.3d34864b.js"><link rel="prefetch" href="/sweetLearnNote/assets/js/14.a43d6e0c.js"><link rel="prefetch" href="/sweetLearnNote/assets/js/16.f67d39e3.js"><link rel="prefetch" href="/sweetLearnNote/assets/js/17.75cfbd8f.js">
    <link rel="stylesheet" href="/sweetLearnNote/assets/css/18.styles.2c39990c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/sweetLearnNote/" class="home-link router-link-active"><!----><span class="site-name">
      学习笔记
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/sweetLearnNote/learnNote/" class="nav-link">学习笔记</a></div><div class="nav-item"><a href="/sweetLearnNote/jsNote/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/sweetLearnNote/vueNote/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/sweetLearnNote/others/" class="nav-link">others</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/sweetLearnNote/learnNote/" class="nav-link">学习笔记</a></div><div class="nav-item"><a href="/sweetLearnNote/jsNote/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/sweetLearnNote/vueNote/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/sweetLearnNote/others/" class="nav-link">others</a></div><!----></nav><ul class="sidebar-links"><li><a href="/sweetLearnNote/jsNote/" class="sidebar-link"> JavaScript</a></li></ul></div><div class="page"><div class="content"><h2 id="好玩的canvas"><a href="#好玩的canvas" aria-hidden="true" class="header-anchor">#</a> 好玩的canvas</h2><h3 id="漂亮的下雨效果"><a href="#漂亮的下雨效果" aria-hidden="true" class="header-anchor">#</a> 漂亮的下雨效果</h3><p>掘金上的详解<a href="https://juejin.im/post/5b022ecdf265da0b7f44d7c3" target="_blank" rel="noopener noreferrer">https://juejin.im/post/5b022ecdf265da0b7f44d7c3</a></p><pre class="language-html"><code><span class="token doctype">&lt;!doctype html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style language-css">
    <span class="token selector">*</span> <span class="token punctuation">{</span>
      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span> <span class="token property">width</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><pre class="language-js"><code>    window<span class="token punctuation">.</span>onload <span class="token operator">=</span> main<span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获取canvas元素</span>
      <span class="token keyword">var</span> canvasEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> ctx <span class="token operator">=</span> canvasEl<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// canvas画布的 背景颜色</span>
      <span class="token keyword">var</span> backgroundColor <span class="token operator">=</span> <span class="token string">'#000'</span><span class="token punctuation">;</span>

      <span class="token comment">// canvas画布的宽 等于 可视区域的宽</span>
      canvasEl<span class="token punctuation">.</span>width <span class="token operator">=</span> canvasEl<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>
      <span class="token comment">// canvas画布的高 等于 可视区域的高</span>
      canvasEl<span class="token punctuation">.</span>height <span class="token operator">=</span> canvasEl<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>

      <span class="token comment">// 保存小水珠的数组</span>
      <span class="token comment">// 雨滴下落后散成小水珠，小水珠就是一些圆弧</span>
      <span class="token keyword">var</span> dropList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token comment">// 重力</span>
      <span class="token comment">// 雨滴下落后散成小水珠，小水珠会先上升后下降，主要是因为 gravity 这个变量的缘故</span>
      <span class="token keyword">var</span> gravity <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>

      <span class="token comment">// 保存雨滴的数组</span>
      <span class="token comment">// 每个雨滴 都是 画的一条线 </span>
      <span class="token keyword">var</span> linelist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token comment">// 保存鼠标的坐标 </span>
      <span class="token comment">// mousePos[0] 代表x轴的值，mousePos[1] 代表y轴的值 </span>
      <span class="token keyword">var</span> mousePos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token comment">// 跟随鼠标， mouseDis 大小区域内的雨滴会消失，形成散落效果</span>
      <span class="token comment">// 以mousePos为圆心，mouseDis为半径，这个范围内的雨滴 都会散开，形成许多小水珠</span>
      <span class="token keyword">var</span> mouseDis <span class="token operator">=</span> <span class="token number">35</span><span class="token punctuation">;</span>

      <span class="token comment">// 更新一次动画，画lineNum 条雨滴，lineNum 值越大，下雨就越密集</span>
      <span class="token keyword">var</span> lineNum <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

      <span class="token comment">// 跟随鼠标方向 变化下雨方向的 速度</span>
      <span class="token comment">// 鼠标移动后，下雨的方向 会慢慢改变，主要靠speedx 这个变量</span>
      <span class="token keyword">var</span> speedx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

      <span class="token comment">// maxspeedx 为 speedx 可以取的最大值</span>
      <span class="token comment">// 当 speedx = maxspeedx时，下雨方向 会 随鼠标移动方向立即改变</span>
      <span class="token keyword">var</span> maxspeedx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

      <span class="token comment">// 页面大小发生变化时，重置canvas画布大小</span>
      window<span class="token punctuation">.</span><span class="token function-variable function">onresize</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        canvasEl<span class="token punctuation">.</span>width <span class="token operator">=</span> canvasEl<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>
        canvasEl<span class="token punctuation">.</span>height <span class="token operator">=</span> canvasEl<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">//移动鼠标触发事件</span>
      window<span class="token punctuation">.</span><span class="token function-variable function">onmousemove</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//  设置mousePos 等于 鼠标坐标</span>
        <span class="token comment">//  e.clientX 为距离 浏览器窗口可视区域 左边的距离</span>
        <span class="token comment">//  e.clientY 为距离 浏览器窗口可视区域 上边的距离</span>
        mousePos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX<span class="token punctuation">;</span>
        mousePos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>clientY<span class="token punctuation">;</span>

        <span class="token comment">// 通过鼠标位置，设置 maxspeedx的值，取值范围是 -1 到 1</span>
        <span class="token comment">// maxspeedx的值，关系到 </span>
        <span class="token comment">// 1、雨滴的方向</span>
        <span class="token comment">// 2、雨滴下落的方向</span>
        <span class="token comment">// 3、雨滴下落方向 跟随 鼠标移动方向变化的速度</span>
        <span class="token comment">// 4、小水珠的移动方向</span>
        <span class="token comment">// 值越接近1，表示方向越向右</span>
        <span class="token comment">// 值越接近-1，表示方向越向左</span>
        maxspeedx <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> canvasEl<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>canvasEl<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 根据参数，返回一个rgb颜色，用于给雨滴设置颜色</span>
      <span class="token keyword">function</span> <span class="token function">getRgb</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;rgb(&quot;</span> <span class="token operator">+</span> r <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> g <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> b <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 画 一滴雨（一条线）</span>
      <span class="token keyword">function</span> <span class="token function">createLine</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 随机生成 雨滴的长度</span>
        <span class="token keyword">var</span> temp <span class="token operator">=</span> <span class="token number">0.25</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">50</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 一个 line 对象，代表一个雨滴</span>
        <span class="token keyword">var</span> line <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token comment">// 雨滴下落速度  </span>
          speed<span class="token punctuation">:</span> <span class="token number">5.5</span> <span class="token operator">*</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">6</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token comment">// 判断是否删除，值为true就删除</span>
          die<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token comment">// 雨滴x坐标 </span>
          posx<span class="token punctuation">:</span> e<span class="token punctuation">,</span>
          <span class="token comment">// 雨滴y坐标 </span>
          posy<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span>
          <span class="token comment">// 雨滴的长度</span>
          h<span class="token punctuation">:</span> temp<span class="token punctuation">,</span>
          <span class="token comment">// 雨滴的颜色</span>
          color<span class="token punctuation">:</span> <span class="token function">getRgb</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>temp <span class="token operator">*</span> <span class="token number">255</span> <span class="token operator">/</span> <span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>temp <span class="token operator">*</span> <span class="token number">255</span> <span class="token operator">/</span> <span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>temp <span class="token operator">*</span> <span class="token number">255</span> <span class="token operator">/</span> <span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// 把创建好的line（雨滴）对象，添加到保存雨滴的数组</span>
        linelist<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 画一个小水珠（雨滴散开后的小水珠就是一个个的圆弧）</span>
      <span class="token keyword">function</span> <span class="token function">createDrop</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 一个 drop 对象，代表一个圆弧</span>
        <span class="token keyword">var</span> drop <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token comment">// 判断是否删除，值为true就删除</span>
          die<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token comment">// 圆弧圆心的x坐标 </span>
          posx<span class="token punctuation">:</span> x<span class="token punctuation">,</span>
          <span class="token comment">// 圆弧圆心的y坐标 </span>
          posy<span class="token punctuation">:</span> y<span class="token punctuation">,</span>
          <span class="token comment">// vx 表示 x轴的值 变化的速度</span>
          vx<span class="token punctuation">:</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">,</span>
          <span class="token comment">// vy 表示 y轴的值 变化的速度 取值范围：-3 到 -9</span>
          vy<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">,</span>
          <span class="token comment">// 圆弧的半径</span>
          radius<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.5</span> <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> drop<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 画一定数量的小水珠</span>
      <span class="token keyword">function</span> <span class="token function">madedrops</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 随机生成一个数 maxi</span>
        <span class="token comment">// maxi 代表要画小水珠的数量</span>
        <span class="token keyword">var</span> maxi <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> maxi<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          dropList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">createDrop</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 开始调用update函数，更新动画</span>
      window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 更新动画</span>
      <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果保存小水珠的数组有内容</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dropList<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 遍历保存小水珠的数组</span>
          dropList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//设置e.vx，vx表示x坐标变化的速度</span>
            <span class="token comment">// (speedx)/2 是为了，让小水珠 在x轴的移动距离短一点，看上去更真实点</span>
            <span class="token comment">// 也使 小水珠的移动方向 和 雨滴方向，雨滴下落方向，鼠标移动方向相同</span>
            e<span class="token punctuation">.</span>vx <span class="token operator">=</span> e<span class="token punctuation">.</span>vx <span class="token operator">+</span> <span class="token punctuation">(</span>speedx <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span>posx <span class="token operator">=</span> e<span class="token punctuation">.</span>posx <span class="token operator">+</span> e<span class="token punctuation">.</span>vx<span class="token punctuation">;</span>
			
			<span class="token comment">//设置e.vy，vy表示y坐标变化的速度</span>
            <span class="token comment">// e.vy的范围是-3 到 -9，而这时e.posy（y坐标）一定是正值，所以 e.posy的值会先减小后增大</span>
            <span class="token comment">// 也就是实现 雨滴散成小水珠，小水珠会先上升后下降的效果</span>
            e<span class="token punctuation">.</span>vy <span class="token operator">=</span> e<span class="token punctuation">.</span>vy <span class="token operator">+</span> gravity<span class="token punctuation">;</span>
            e<span class="token punctuation">.</span>posy <span class="token operator">=</span> e<span class="token punctuation">.</span>posy <span class="token operator">+</span> e<span class="token punctuation">.</span>vy<span class="token punctuation">;</span>

            <span class="token comment">// 如果 小水珠y坐标 大于 可视区域的高度，设置die属性为true</span>
            <span class="token comment">// 小水珠如果超出可视区域就删除掉</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>posy <span class="token operator">&gt;</span> canvasEl<span class="token punctuation">.</span>clientHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              e<span class="token punctuation">.</span>die <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 删除 die属性为ture 的数组成员</span>
        <span class="token comment">// 可视区域外的小水珠删除掉</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> dropList<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>dropList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>die<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dropList<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 设置下雨方向变换的速度，取值范围： -1 到 1</span>
        <span class="token comment">// 当 speedx = maxspeedx时，下雨方向 会 随鼠标移动方向立即改变</span>
        speedx <span class="token operator">=</span> speedx <span class="token operator">+</span> <span class="token punctuation">(</span>maxspeedx <span class="token operator">-</span> speedx<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">50</span><span class="token punctuation">;</span>

        <span class="token comment">// 根据lineNum的值，画一定数量雨滴</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lineNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		  <span class="token comment">// 调用createLine 函数，参数是雨滴x坐标</span>
          <span class="token function">createLine</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> canvasEl<span class="token punctuation">.</span>width <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">0.5</span> <span class="token operator">*</span> canvasEl<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 设置结束线，也就是雨滴散开 形成许多小水珠的位置</span>
        <span class="token keyword">var</span> endLine <span class="token operator">=</span> canvasEl<span class="token punctuation">.</span>clientHeight <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvasEl<span class="token punctuation">.</span>clientHeight <span class="token operator">/</span> <span class="token number">5</span><span class="token punctuation">;</span>

        <span class="token comment">// 遍历保存雨滴的数组</span>
        linelist<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>

          <span class="token comment">// 利用勾股定理 确定一个范围，在这个范围内雨滴会散开形成小水珠</span>
          <span class="token comment">// e.posx + speedx * e.h 是雨滴x坐标</span>
          <span class="token comment">// e.posy + e.h 是雨滴y坐标</span>
          <span class="token keyword">var</span> dis <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>posx <span class="token operator">+</span> speedx <span class="token operator">*</span> e<span class="token punctuation">.</span>h<span class="token punctuation">)</span> <span class="token operator">-</span> mousePos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>posx <span class="token operator">+</span> speedx <span class="token operator">*</span> e<span class="token punctuation">.</span>h<span class="token punctuation">)</span> <span class="token operator">-</span> mousePos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>posy <span class="token operator">+</span> e<span class="token punctuation">.</span>h <span class="token operator">-</span> mousePos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>posy <span class="token operator">+</span> e<span class="token punctuation">.</span>h <span class="token operator">-</span> mousePos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// 如果在mouseDis区域内，就删除雨滴，画一些小水珠（圆弧）</span>
          <span class="token comment">// 实现鼠标碰到雨滴，雨滴散成小水珠的效果</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>dis <span class="token operator">&lt;</span> mouseDis<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 删除 雨滴</span>
            e<span class="token punctuation">.</span>die <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token comment">// 画一些小水珠（圆弧）</span>
            <span class="token function">madedrops</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>posx <span class="token operator">+</span> speedx <span class="token operator">*</span> e<span class="token punctuation">.</span>h<span class="token punctuation">,</span> e<span class="token punctuation">.</span>posy <span class="token operator">+</span> e<span class="token punctuation">.</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token comment">// 如果雨滴超过 结束线，删除雨滴，画一些小水珠（圆弧）</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>posy <span class="token operator">+</span> e<span class="token punctuation">.</span>h<span class="token punctuation">)</span> <span class="token operator">&gt;</span> endLine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span>die <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token function">madedrops</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>posx <span class="token operator">+</span> speedx <span class="token operator">*</span> e<span class="token punctuation">.</span>h<span class="token punctuation">,</span> e<span class="token punctuation">.</span>posy <span class="token operator">+</span> e<span class="token punctuation">.</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token comment">// 如果 雨滴 y坐标 大于 可视区域的高度，设置die属性为true</span>
          <span class="token comment">// 如果 雨滴 超出可视区域就删除掉</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>posy <span class="token operator">&gt;=</span> canvasEl<span class="token punctuation">.</span>clientHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span>die <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 逐渐增加 雨滴 y坐标的值</span>
            e<span class="token punctuation">.</span>posy <span class="token operator">=</span> e<span class="token punctuation">.</span>posy <span class="token operator">+</span> e<span class="token punctuation">.</span>speed<span class="token punctuation">;</span>

            <span class="token comment">// 变化雨滴 x坐标</span>
            <span class="token comment">// * speedx 用来控制雨滴 下落 方向</span>
            <span class="token comment">// 使 雨滴下落方向 和 鼠标移动方向相同</span>
            e<span class="token punctuation">.</span>posx <span class="token operator">=</span> e<span class="token punctuation">.</span>posx <span class="token operator">+</span> e<span class="token punctuation">.</span>speed <span class="token operator">*</span> speedx<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 删除 die属性为ture 的数组成员</span>
        <span class="token comment">// 鼠标区域内的，超过结束线的，可视区域外的雨滴删除掉</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> linelist<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>linelist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>die<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            linelist<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 渲染</span>
        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 递归调用 update，实现动画效果</span>
        window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 渲染</span>
      <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 画一个和可视区域一样大的矩形</span>
        ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> backgroundColor<span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvasEl<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvasEl<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 画雨滴效果</span>
        ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        linelist<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>line<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          ctx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> line<span class="token punctuation">.</span>color<span class="token punctuation">;</span>
          ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span>posx<span class="token punctuation">,</span> line<span class="token punctuation">.</span>posy<span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// * speedx 用来控制雨滴方向</span>
          <span class="token comment">// 使 雨滴方向 和 鼠标移动方向相同</span>
          ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span>posx <span class="token operator">+</span> line<span class="token punctuation">.</span>h <span class="token operator">*</span> speedx<span class="token punctuation">,</span> line<span class="token punctuation">.</span>posy <span class="token operator">+</span> line<span class="token punctuation">.</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
          ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 画雨滴散开形成小水珠效果</span>
        ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">&quot;#fff&quot;</span><span class="token punctuation">;</span>
        dropList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>posx<span class="token punctuation">,</span> e<span class="token punctuation">.</span>posy<span class="token punctuation">,</span> e<span class="token punctuation">.</span>radius<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 解开注释，可看见鼠标范围</span>
        <span class="token comment">/*
          ctx.beginPath();
          ctx.arc(mousePos[0], mousePos[1], mouseDis, 0, 2 * Math.PI);
          ctx.stroke();
        */</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre></div><!----><!----></div></div></div>
    <script src="/sweetLearnNote/assets/js/15.1410e0a9.js" defer></script><script src="/sweetLearnNote/assets/js/app.e5601e0e.js" defer></script>
  </body>
</html>
